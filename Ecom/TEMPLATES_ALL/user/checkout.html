
{% extends 'base/base.html' %}

{% load static %}

{% load dict_filters %}

{% block css %} 

<link rel="stylesheet" href="{% static 'css/base.css' %}">
<link rel="stylesheet" href="{% static 'css/nav.css' %}">
<link rel="stylesheet" href="{% static 'css/loader.css' %}">
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<style>

    
    .img_container{
        width:150px;
        margin-bottom: 15px;
    }

    .main_container{
        width:300px;
    }

    .img-box{
        flex-basis: 20%;  
    }

    body{
        display: block;
    }
    .nav-background{

        background-image: url("{% static 'image/banner/cn.jpg' %}");
        background-repeat: no-repeat;
        background-size: cover;
        width:100%;
        height:150px
    }

    .main-background{

        background-color: var(--main-color);
    }

 


    .selected_color{

        padding:5px;
        border:1px solid var(--main-color);
    }

    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
    }

    
</style>
{% endblock %}

{% block main %}

{% include 'base/loader.html' %}

{% include 'base/nav.html' %}

<div class="container-fluid p-0">
    <div class="nav-background">
        
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-lg-6">
            <div class="container-fluid my-4">
                {% for each in products %}
                <div class="row mb-3 border rounded p-3">
                    

                    <div class="col-4">
                        <img src="{{each.connect.image.normal_image.url}}" alt="image" class="img-fluid rounded" style="height:150px;object-fit: cover;">
                    </div>

                    <div class="col-4">
                        <p class="fs-4 m-0">{{each.connect.product.name}}</p>
                        <p class="fs-5 m-0" style="width: 100%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{each.connect.product.description}}</p>
                        <div class="d-flex align-items-center" style="gap:30px;">
                            <p class="fs-6 m-0 text-success"> ₹ {{each.connect.product.price}}</p>
                            <p class="text-secondary m-0">Size : {{each.connect.size.size}}</p>
                        </div>

                        <div class="d-flex" style="gap:30px;">
                            <p class="m-0 badge bg-secondary fs-6 fw-normal">{{each.connect.color.name}}</p>
                            <p class="m-0 badge bg-secondary fs-6 fw-normal">{{each.connect.product.brand.name}}</p>
                            <p class="m-0 badge bg-secondary fs-6 fw-normal">{{each.connect.product.category.name}}</p>
                        </div>
                    </div>

                </div>
                {% endfor %}

                <div class="row">
                    <p class="m-0">Total <small class="ms-4 fs-4 fw-bold">₹ {{total_amount}}</small></p>
                    <p class="text-success m-0"> Delivary Free</p>
                </div>

            </div>
        </div>
        <div class="col-lg-6">


            <form  method="post">
                {% csrf_token %}
                <p  class="my-4">select the address</p>
                <div class="container-fluid">
                    <div class="row">
                        
                            {% if address %}
                            {% for ism in address %}
                            <div class="col-lg-6">
                                <div class="form-check d-flex align-items-center" style="gap:30px;">
                                    {% if ism.primary_address %}
                                    <input class="form-check-input" name="address" type="radio" value="{{ism.id}}" id="add{{forloop.counter}}" checked>
                                    {% else %}
                                    <input class="form-check-input"  name="address" type="radio" value="{{ism.id}}" id="add{{forloop.counter}}">
                                    {% endif %}
                                    <label class="form-check-label" for="add{{forloop.counter}}">
                                    <div class="p-3 border rounded">
                                            <p class="m-0">{{ism.village}}</p>
                                            <p class="m-0">{{ism.city}}</p>
                                            <div class="d-flex">
                                                <p class="m-0">{{ism.district}} - </p>
                                                <p class="m-0">{{ism.pincode}}</p>
                                            </div>
                                            <p class="m-0">{{ism.first_phone_number}}</p>
                                            {% if ism.second_phone_number %}
                                            <p class="m-0">{{ism.second_phone_number}}</p>
                                            {% endif %}

                                            {% if ism.landmark %}
                                            <p class="m-0">{{ism.landmark}}</p>
                                            {% endif %}

                                            <a href="{% url 'Ecom:addressupdate' pk=ism.id %}?next={% url 'Ecom:checkout' %}" class="btn btn-outline-dark">CHANGE ADDRESS</a>

                                    </div>
                                    </label>
                                </div>
                            </div>
                            {% endfor %}
                            
                            {% endif %}
                        
                    </div>
                </div>
                

                <a href="{% url 'Ecom:addaddress' %}?next={% url 'Ecom:checkout' %}" class="btn btn-outline-dark">ADD ADDRESS</a>

                <p  class="my-4">payment method</p>

                <select class="form-select form-select-lg mb-3 fs-6" aria-label=".form-select-lg example" style="width: max-content;">
                    <option value="1" selected>Cash On Delivery</option>
                    <option value="2" >online</option>
                </select>
                <div class="text-center my-5">
                    <input type="submit" value="PLACE ORDER" class="btn btn-outline-dark ">

                </div>
                
            </form>
        </div>
    </div>
</div>

{% endblock %}

{% block script %}



<!-- script for scroll -->
<script src="{% static 'js/navscroll.js' %}"></script>

<!-- loader  -->
<script src="{% static 'js/loader.js' %}"></script>

<!-- <script>

axios.defaults.xsrfHeaderName = "X-CSRFTOKEN"
axios.defaults.xsrfCookieName = "csrftoken"

let needed_count = document.querySelectorAll('.needed_count');
needed_count.forEach(ele=>{

    ele.addEventListener('input',(e)=>{
        if (ele.value >= 5){
            ele.value = 5;
        }

        if (ele.value =='' || ele.value==0){
            ele.value = 1;

        }
    })
})

let total_amount  = ()=>{
    let each_cart_row = document.querySelectorAll('.each_cart_row');
    let amount = 0;
    let total_count = 0;
    each_cart_row.forEach(ele=>{
        let input_check = ele.querySelector('input[type="checkbox"]');
        if (input_check.checked){
            let price = parseInt(ele.querySelector('.amout_product').dataset.amount);
            let count = parseInt(ele.querySelector('input.needed_count').value);
            amount  = amount + ( price * count );
            console.log(ele.querySelector('.amout_product').dataset.amount);
            total_count +=1;
        }
    })

    let total_count_box = document.getElementById('total_count');
    let total_amount_box = document.getElementById('total_amount');
    total_count_box.innerText = `Total items (${total_count})`;
    total_amount_box.innerText=`Total price ₹${amount}`;
}

total_amount()

let minus_button = document.querySelectorAll('.minus_button');

minus_button.forEach(ele=>{

    ele.addEventListener('click' , (e)=>{
        if (ele.nextElementSibling.value == 1) return

        const formData = new FormData()
        formData.append('action', 0)
        formData.append('pk' ,ele.nextElementSibling.dataset.pk )
        
        
        // for (var [key, value] of formData.entries()) { 
        //     console.log(key, value);
        // }

        axios.post('{% url "Ecom:updatecart" %}',formData)

        .then(function(response){

            if (response.data.success){
                ele.nextElementSibling.value = parseInt(ele.nextElementSibling.value) - 1
                total_amount()
            }
            else{
                console.log("there is a error...")
            }
        })
        .catch(function(error) {
            // Handle network or other errors
            console.error('An error occurred:', error);
        });

        

    })
})

let plus_button = document.querySelectorAll('.plus_button');

plus_button.forEach(ele=>{

    ele.addEventListener('click' , (e)=>{
        if (ele.previousElementSibling.value == parseInt(ele.dataset.max)) return

        const formData = new FormData()
        formData.append('action', 1)
        formData.append('pk' ,ele.previousElementSibling.dataset.pk )

        axios.post('{% url "Ecom:updatecart" %}',formData)

        .then(function(response){

            if (response.data.success){
                ele.previousElementSibling.value = parseInt(ele.previousElementSibling.value) + 1
                total_amount()
            }
            else{
                console.log("there is a error...")
            }
        })
        .catch(function(error) {
            // Handle network or other errors
            console.error('An error occurred:', error);
        });

        
    })
})

const parent_container_cart = document.getElementById('parent_container_cart');
let cart_delete_button = document.querySelectorAll('.cart_delete_button');

cart_delete_button.forEach(ele =>{

    ele.addEventListener('click' ,(e)=>{
        e.preventDefault();
        const formData = new FormData()
        formData.append('pk', ele.dataset.delete)
        axios.post("{% url 'Ecom:deletecart' %}" , formData)
        .then(function(response){

            if (response.data.success){
                let child = document.getElementById(ele.dataset.target)
                parent_container_cart.removeChild(child)
                setTimeout(()=>{
                    total_amount()
                },100)
            }
            else{
                console.log("there is a error...")
            }
        })
        .catch(function(error) {
            // Handle network or other errors
            console.error('An error occurred:', error);
        });

    })
})


const checkout_button = document.getElementById('checkout_button');

checkout_button.addEventListener('click' , (e)=>{

    e.preventDefault()

    let all_items = document.querySelectorAll('input[name="items"]:checked');
    var formData = new FormData();
    all_items.forEach(ele=>{
        formData.append("values", ele.value);
    })
    var xhr = new XMLHttpRequest();
    xhr.open("POST",checkout_button.href );

    xhr.onreadystatechange = function() {
    if (xhr.readyState === 4 && xhr.status === 200) {
    //   var response = JSON.parse(xhr.responseText);
      // Process the response data as needed
    //   console.log(response);

      // Redirect to a different page after receiving the response
      window.location.href = "{% url 'Ecom:checkout' %}"; // Replace "/success-page" with the desired URL
    }
  };

    xhr.setRequestHeader("X-CSRFToken", '{{csrf_token}}'); 
    xhr.send(formData)

    

})
</script> -->

{% endblock %}